# Kong配置文件
# 用于IoT微服务架构

# 数据库配置（使用声明式配置，无需数据库）
database = off
declarative_config = /kong/kong.yml

# 代理端口配置
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl

# 日志配置
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# 性能配置
nginx_worker_processes = auto
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60

# DNS配置
dns_resolver = 127.0.0.11
dns_order = LAST,A,CNAME

# 信任所有IP（Docker网络）
trusted_ips = 0.0.0.0/0,::/0
real_ip_header = X-Forwarded-For
real_ip_recursive = on

# 日志格式
log_level = info

# 插件加载
plugins = bundled

# 超时配置
nginx_http_client_body_timeout = 60s
nginx_http_client_header_timeout = 60s
nginx_http_send_timeout = 60s
